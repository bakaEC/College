# Chapter 3.2 盲注

[toc]

---

## 原理

> 盲注：在普通注入方式无法获得页面回显的有效信息时通过其他方式判断服务器回应时使用的特殊注入方式。

### 布尔型盲注

> 布尔包含两个返回值：**True**和**False**，对应页面中服务器会根据注入信息**返回正常信息**或**报错**。

### 时间型盲注

> 只包含一个返回值：**True**，此时无论输入任何注入信息都会按照正常语句过滤处理。此时当加入**时间参数**后，通过判断**是否进入延时状态**得知输入的语句是否正确。

## 解题思路

### 布尔型盲注

1. 判断是否存在注入
2. 判断注入字段数
3. 判断注入点、注入方式
4. 通过`length(str)` 判断库名长度
5. 通过`substr(str,pos,length)`截取字符，嵌套入`ascii(char)`内转义为ASCII码，再通过不断遍历常用ASCII编码和内部截取字符位置通过**返回的页面结果**暴破库名
6. 使用相同方法暴破表名、字段名

### 时间型盲注

1. 判断是否存在注入
2. 判断注入字段数
3. 判断注入点、注入方式
4. 通过`length(str)` 判断库名长度
5. 通过`sleep(t)`挂起页面，嵌套入`if(eval,exp1,exp2)`的**exp2**中，此时**eval**中为通过`substr(str,pos,length)`截取的字符，嵌套入`ascii(char)`内转义为ASCII码，通过不断遍历常用ASCII编码和内部截取字符位置通过**返回的时间差**暴破库名
6. 使用相同方法暴破表名、字段名

## 解题过程

### 布尔型盲注	Rank1

1. 输入`and 1=1`，有数据返回；输入`and 1=2`，无数据返回，证明存在注入
2. 通过`order by [n]`判断字段数，此时字段数为2，不过通过`union select 1,2`发现页面有返回却无回显点，可知此时使用盲注
3. 使用`length(database()) > [n]`查询数据库长度，不断变化等式后数值n，直到匹配出长度。本题中长度为12
4. 通过`ascii(substr(database(),[n],1)) = [m]` 按序暴破每位字符n的ASCII码十进制表示m，直到遍历完12位库名。此处使用Burp Suite工具暴破,得到十二位ASCII十进制码（107,97,110,119,111,108,111,110,103,120,105,97）
5. 使用编码表转换出最终库名`kanwolongxia`
6. 使用同样的方式暴破出表名`ascii(substr((select 1,table_name from information_schema.tables where table_schema=database(),[n],1))=[m]`,此时使用工具SQLmap进行表名暴破，包含flag的结果为`loflag`
7. 相同方式进行dump，最终得出flag:`zKaQ-QQQ`

### 布尔型盲注 Rank2

与**Rank1**相同，需要自行添加闭合符`"`和注释`-- 0`把后面的后引号注释掉

### 布尔型盲注 Rank3

与**Rank1**相同，需要在第一个输入框输入`\` 将后引号转义，在下一个输入框使用`or`进行判断（因为输入账号密码部分判断取False），再加入执行的查询语句，最后加入`-- 0`把后引号注释掉

### 时间型盲注 Rank1	Rank2	Rank3

1. 输入`and 1=1`，有数据返回；输入`and 1=2`，无数据返回，证明存在注入
2. 使用`length(database()) > (n)`查询数据库长度，不断变化不等式后数值n，直到匹配出长度。本题中长度为12
3. 将**布尔型盲注-Rank1**中的3~6步嵌套入`if()`，加入延时`sleep()`函数，最终效果if([SQL],sleep(5),1)`，能实现在正确时页面挂起五秒(在此使用SQLmap)
4. **Rank2**和**Rank3**需要自行添加闭合符`"`和注释`-- 0`把后面的后引号注释掉

## 思考

1. SQLmap工具具有一定局限性，并不是所有的注入类型都能被准确且快速的识别，目前最有效的人工配合方法就是用burp捕捉request之后进行指定位置，以及设置--risk和--level等级以进行更多尝试
2. 猜测数据库长度时尽量使用不等式进行范围界定
3. 如果使用burpsuit进行时间盲注时尽量关闭多线程，以免线程堵塞和判定失败
4. 盲注时判断种类的最快方法就是观察输入错误语句时的页面回显

